generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String     @id @default(uuid())
  email            String     @unique
  name             String     @default("user")
  password         String
  role             Role
  refreshToken     String?
  createdAt        DateTime   @default(now())
  image            String?
  teamLeaderId     String?
  Contract         Contract[]
  leads            Lead[]
  logs             Log[]
  assignedMeetings Meeting[]  @relation("AssignedMeetings")
  createdMeetings  Meeting[]  @relation("CreatedMeetings")
  assignedTasks    Task[]     @relation("AssignedTasks")
  createdTasks     Task[]     @relation("CreatedTasks")
  teamLeader       User?      @relation("TeamMembers", fields: [teamLeaderId], references: [id])
  teamMembers      User[]     @relation("TeamMembers")
  visit            Visit[]
}

model Lead {
  id                  String     @id @default(uuid())
  nameAr              String?
  nameEn              String?
  contact             String?
  status              LeadStatus
  lastCall            DateTime?
  lastVisit           DateTime?
  ownerId             String?
  inventoryInterestId String?
  createdAt           DateTime   @default(now())
  email               String?
  notes               String[]
  source              String?
  budget              BigInt?
  contacts            String[]
  familyName          String?
  firstConection      DateTime?
  interest            Interest   @default(under_decision)
  tier                Tier       @default(bronze)
  cil                 Boolean?   @default(false)
  description         String?
  otherProject        String?
  projectInterestId   String?
  calls               Call[]
  Contract            Contract[]
  inventoryInterest   Inventory? @relation(fields: [inventoryInterestId], references: [id])
  owner               User?      @relation(fields: [ownerId], references: [id])
  projectInterest     Project?   @relation("LeadProjectInterest", fields: [projectInterestId], references: [id])
  logs                Log[]
  meetings            Meeting[]
  tasks               Task[]
  visits              Visit[]
}

model Inventory {
  id               String     @id @default(uuid())
  title            String?
  price            Float?
  area             Float?
  bedrooms         Int?
  bathrooms        Int?
  images           String[]
  projectId        String?
  createdAt        DateTime   @default(now())
  amenities        String[]
  amenitiesOther   String?
  developerId      String?
  location         String?
  parking          String?
  titleAr          String?
  titleEn          String?
  type             String?
  typeOther        String?
  zoneId           String?
  status           String?
  paymentPlanIndex Int?
  Contract         Contract[]
  developer        Developer? @relation(fields: [developerId], references: [id])
  project          Project?   @relation(fields: [projectId], references: [id])
  zone             Zone?      @relation(fields: [zoneId], references: [id])
  leads            Lead[]
  meetings         Meeting[]
  tasks            Task[]
  visits           Visit[]
}

model Project {
  id            String        @id @default(uuid())
  nameEn        String
  nameAr        String?
  type          String
  description   String?
  images        String[]
  developerId   String?
  zoneId        String?
  createdAt     DateTime      @default(now())
  calls         Call[]
  inventories   Inventory[]
  leadsInterest Lead[]        @relation("LeadProjectInterest")
  meetings      Meeting[]
  paymentPlans  PaymentPlan[]
  developer     Developer?    @relation(fields: [developerId], references: [id])
  zone          Zone?         @relation(fields: [zoneId], references: [id])
  tasks         Task[]
}

model PaymentPlan {
  id                     String            @id @default(uuid())
  downpayment            Float
  installment            Float
  delivery               Float
  schedule               String?
  description            String?
  yearsToPay             Int?
  projectId              String?
  createdAt              DateTime          @default(now())
  installmentPeriod      InstallmentPeriod
  deliveryDate           DateTime?
  firstInstallmentDate   DateTime?
  installmentMonthsCount Float?
  project                Project?          @relation(fields: [projectId], references: [id])
}

model Visit {
  id          String     @id @default(uuid())
  date        String?
  status      String?
  notes       String?
  leadId      String?
  createdAt   DateTime   @default(now())
  createdById String?
  objections  String?
  inventoryId String?
  createdBy   User?      @relation(fields: [createdById], references: [id])
  inventory   Inventory? @relation(fields: [inventoryId], references: [id])
  lead        Lead?      @relation(fields: [leadId], references: [id])
}

model Call {
  id        String   @id @default(uuid())
  date      String?
  outcome   String?
  duration  String?
  projectId String?
  notes     String?
  leadId    String?
  createdAt DateTime @default(now())
  createdBy String?
  project   String?
  lead      Lead?    @relation(fields: [leadId], references: [id])
  Project   Project? @relation(fields: [projectId], references: [id])
}

model Log {
  id          Int      @id @default(autoincrement())
  action      String
  description String?
  userId      String?
  userName    String?
  email       String?
  userRole    String?
  leadId      String?
  ip          String?
  userAgent   String?
  createdAt   DateTime @default(now())
  lead        Lead?    @relation(fields: [leadId], references: [id])
  user        User?    @relation(fields: [userId], references: [id])
}

model Zone {
  id          String      @id @default(uuid())
  nameEn      String
  nameAr      String?
  description String?
  latitude    Float
  longitude   Float
  inventories Inventory[]
  projects    Project[]
}

model Developer {
  id          String      @id @default(uuid())
  nameEn      String?
  location    String?
  established String?
  nameAr      String?
  logo        String?
  email       String?
  phone       String?
  inventories Inventory[]
  projects    Project[]
}

model Contract {
  id           String          @id @default(uuid())
  leadId       String?
  inventoryId  String?
  dealValue    Float?
  contractDate String?
  createdById  String?
  notes        String?
  createdAt    DateTime        @default(now())
  status       ContractStatus?
  createdBy    User?           @relation(fields: [createdById], references: [id])
  inventory    Inventory?      @relation(fields: [inventoryId], references: [id])
  lead         Lead?           @relation(fields: [leadId], references: [id])
}

model Meeting {
  id           String     @id @default(uuid())
  date         String?
  status       String?
  notes        String?
  objections   String?
  location     String?
  leadId       String?
  createdById  String?
  inventoryId  String?
  projectId    String?
  createdAt    DateTime   @default(now())
  assignedToId String?
  client       String?
  duration     String?
  time         String?
  title        String?
  type         String?
  locationType String?
  assignedTo   User?      @relation("AssignedMeetings", fields: [assignedToId], references: [id])
  createdBy    User?      @relation("CreatedMeetings", fields: [createdById], references: [id])
  inventory    Inventory? @relation(fields: [inventoryId], references: [id])
  lead         Lead?      @relation(fields: [leadId], references: [id])
  project      Project?   @relation(fields: [projectId], references: [id])
}

model Task {
  id           String       @id @default(uuid())
  title        String
  description  String?
  dueDate      DateTime
  priority     TaskPriority @default(medium)
  status       TaskStatus   @default(pending)
  type         TaskType
  reminder     Boolean      @default(true)
  reminderTime DateTime?
  emailSent    Boolean      @default(false)
  assignedToId String?
  createdById  String?
  leadId       String?
  projectId    String?
  inventoryId  String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  assignedTo   User?        @relation("AssignedTasks", fields: [assignedToId], references: [id])
  createdBy    User?        @relation("CreatedTasks", fields: [createdById], references: [id])
  inventory    Inventory?   @relation(fields: [inventoryId], references: [id])
  lead         Lead?        @relation(fields: [leadId], references: [id])
  project      Project?     @relation(fields: [projectId], references: [id])
}

enum ContractStatus {
  Pending
  Signed
  Cancelled
}

enum Role {
  admin
  sales_admin
  team_leader
  sales_rep
}

enum InstallmentPeriod {
  monthly
  quarterly
  yearly
  custom
}

enum LeadStatus {
  fresh_lead
  follow_up
  scheduled_visit
  open_deal
  cancellation
  closed_deal
  no_answer
  not_intersted_now
  reservation
  vip
  non_stop
}

enum Interest {
  hot
  warm
  under_decision
}

enum Tier {
  bronze
  silver
  gold
  platinum
}

enum InventoryStatus {
  available
  reserved
  sold
  under_construction
}

enum TaskPriority {
  low
  medium
  high
  urgent
}

enum TaskStatus {
  pending
  in_progress
  completed
  cancelled
  overdue
}

enum TaskType {
  follow_up
  meeting_preparation
  contract_review
  payment_reminder
  visit_scheduling
  lead_nurturing
  general
}
